# B+ Tree (inprogress)
import math

class Node:
    def __init__(self, isLeaf=False):
        self.keys = []
        self.isLeaf = isLeaf
        self.parent = None

        if isLeaf:
            self.values = []
            self.LPC = None
            self.RPC = None
        else:
            self.children = []


class BPlusTree:
    def __init__(self, order=5):
        self.root = Node(isLeaf=True)
        self.order = order
        self.max_keys = order - 1
        self.min_keys = math.ceil(order/2) - 1
        self.actual_height = 1

    def search(self, key):
        leaf = self.find_leaf(key)

        # look through leaf keys
        for i in range(len(leaf.keys)):
            if leaf.keys[i] == key:
                return leaf.values[i]
        return None

    def find_leaf(self, key):
        node = self.root
        # move down until leaf
        while not node.isLeaf:
            i = 0
            # find child pointer
            while i < len(node.keys) and key >= node.keys[i]:
                i += 1
            node = node.children[i]
        return node

    def insert(self, key, value):
        leaf = self.find_leaf(key)

        # find the right place to put it
        i = 0
        while i < len(leaf.keys) and leaf.keys[i] < key:
            i += 1

        leaf.keys.insert(i, key)
        leaf.values.insert(i, value)

        # split leaf if overflow
        if len(leaf.keys) > self.max_keys:
            self.split_leaf(leaf)

    def split_leaf(self, leaf):

        newLeaf = Node(isLeaf=True)

        mid = math.ceil(self.order/2)

        # right half â†’ new leaf
        newLeaf.keys = leaf.keys[mid:]
        newLeaf.values = leaf.values[mid:]

        # left half (old leaf keeps)
        leaf.keys = leaf.keys[:mid]
        leaf.values = leaf.values[:mid]

        # fix linked list
        newLeaf.RPC = leaf.RPC
        if newLeaf.RPC:
            newLeaf.RPC.LPC = newLeaf

        leaf.RPC = newLeaf
        newLeaf.LPC = leaf

        # key to push up
        promotedKey = newLeaf.keys[0]

        self.insert_into_parent(leaf, promotedKey, newLeaf)

        
        #def insert_in_parent()
